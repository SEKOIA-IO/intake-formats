{
  "input": {
    "message": "{\"schemaVersion\":\"2.0\",\"accountId\":\"111111111111\",\"region\":\"eu-west-2\",\"partition\":\"aws\",\"id\":\"3941673a580340dcb61648a3e15def75\",\"arn\":\"arn:aws:guardduty:eu-west-2:111111111111:detector/4b85f358-65e7-49b6-b9ae-b3816303fb12/finding/3941673a580340dcb61648a3e15def75\",\"type\":\"Discovery:S3/MaliciousIPCaller.Custom\",\"resource\":{\"resourceType\":\"S3Bucket\",\"accessKeyDetails\":{\"accessKeyId\":\"GeneratedFindingAccessKeyId\",\"principalId\":\"GeneratedFindingPrincipalId\",\"userType\":\"IAMUser\",\"userName\":\"GeneratedFindingUserName\"},\"s3BucketDetails\":[{\"arn\":\"arn:aws:s3:::bucketName\",\"name\":\"bucketName\",\"type\":\"Destination\",\"createdAt\":1.513612691551E9,\"owner\":{\"id\":\"CanonicalId of Owner\"},\"tags\":[{\"key\":\"foo\",\"value\":\"bar\"}],\"defaultServerSideEncryption\":{\"encryptionType\":\"SSEAlgorithm\",\"kmsMasterKeyArn\":\"arn:aws:kms:region:123456789012:key/key-id\"},\"publicAccess\":{\"permissionConfiguration\":{\"bucketLevelPermissions\":{\"accessControlList\":{\"allowsPublicReadAccess\":false,\"allowsPublicWriteAccess\":false},\"bucketPolicy\":{\"allowsPublicReadAccess\":false,\"allowsPublicWriteAccess\":false},\"blockPublicAccess\":{\"ignorePublicAcls\":false,\"restrictPublicBuckets\":false,\"blockPublicAcls\":false,\"blockPublicPolicy\":false}},\"accountLevelPermissions\":{\"blockPublicAccess\":{\"ignorePublicAcls\":false,\"restrictPublicBuckets\":false,\"blockPublicAcls\":false,\"blockPublicPolicy\":false}}},\"effectivePermission\":\"NOT_PUBLIC\"}}],\"instanceDetails\":{\"instanceId\":\"i-99999999\",\"instanceType\":\"m3.xlarge\",\"outpostArn\":\"arn:aws:outposts:us-west-2:123456789000:outpost/op-0fbc006e9abbc73c3\",\"launchTime\":\"2016-08-02T02:05:06.000Z\",\"platform\":null,\"productCodes\":[{\"productCodeId\":\"GeneratedFindingProductCodeId\",\"productCodeType\":\"GeneratedFindingProductCodeType\"}],\"iamInstanceProfile\":{\"arn\":\"arn:aws:iam::111111111111:example/instance/profile\",\"id\":\"GeneratedFindingInstanceProfileId\"},\"networkInterfaces\":[{\"ipv6Addresses\":[],\"networkInterfaceId\":\"eni-bfcffe88\",\"privateDnsName\":\"GeneratedFindingPrivateDnsName\",\"privateIpAddress\":\"10.0.0.1\",\"privateIpAddresses\":[{\"privateDnsName\":\"GeneratedFindingPrivateName\",\"privateIpAddress\":\"10.0.0.1\"}],\"subnetId\":\"GeneratedFindingSubnetId\",\"vpcId\":\"GeneratedFindingVPCId\",\"securityGroups\":[{\"groupName\":\"GeneratedFindingSecurityGroupName\",\"groupId\":\"GeneratedFindingSecurityId\"}],\"publicDnsName\":\"GeneratedFindingPublicDNSName\",\"publicIp\":\"198.51.100.0\"}],\"tags\":[{\"key\":\"GeneratedFindingInstaceTag1\",\"value\":\"GeneratedFindingInstaceValue1\"},{\"key\":\"GeneratedFindingInstaceTag2\",\"value\":\"GeneratedFindingInstaceTagValue2\"},{\"key\":\"GeneratedFindingInstaceTag3\",\"value\":\"GeneratedFindingInstaceTagValue3\"},{\"key\":\"GeneratedFindingInstaceTag4\",\"value\":\"GeneratedFindingInstaceTagValue4\"},{\"key\":\"GeneratedFindingInstaceTag5\",\"value\":\"GeneratedFindingInstaceTagValue5\"},{\"key\":\"GeneratedFindingInstaceTag6\",\"value\":\"GeneratedFindingInstaceTagValue6\"},{\"key\":\"GeneratedFindingInstaceTag7\",\"value\":\"GeneratedFindingInstaceTagValue7\"},{\"key\":\"GeneratedFindingInstaceTag8\",\"value\":\"GeneratedFindingInstaceTagValue8\"},{\"key\":\"GeneratedFindingInstaceTag9\",\"value\":\"GeneratedFindingInstaceTagValue9\"}],\"instanceState\":\"running\",\"availabilityZone\":\"GeneratedFindingInstaceAvailabilityZone\",\"imageId\":\"ami-99999999\",\"imageDescription\":\"GeneratedFindingInstaceImageDescription\"}},\"service\":{\"serviceName\":\"guardduty\",\"detectorId\":\"4b85f358-65e7-49b6-b9ae-b3816303fb12\",\"action\":{\"actionType\":\"AWS_API_CALL\",\"awsApiCallAction\":{\"api\":\"GeneratedFindingAPIName\",\"serviceName\":\"GeneratedFindingAPIServiceName\",\"callerType\":\"Remote IP\",\"errorCode\":\"AccessDenied\",\"remoteIpDetails\":{\"ipAddressV4\":\"198.51.100.0\",\"organization\":{\"asn\":\"-1\",\"asnOrg\":\"GeneratedFindingASNOrg\",\"isp\":\"GeneratedFindingISP\",\"org\":\"GeneratedFindingORG\"},\"country\":{\"countryName\":\"GeneratedFindingCountryName\"},\"city\":{\"cityName\":\"GeneratedFindingCityName\"},\"geoLocation\":{\"lat\":0,\"lon\":0}},\"affectedResources\":{\"AWS::S3::Bucket\":\"GeneratedFindingS3Bucket\"}}},\"resourceRole\":\"TARGET\",\"additionalInfo\":{\"unusual\":{\"hoursOfDay\":[1513609200000],\"userNames\":[\"GeneratedFindingUserName\"]},\"sample\":true,\"value\":\"{\\\"unusual\\\":{\\\"hoursOfDay\\\":[1513609200000],\\\"userNames\\\":[\\\"GeneratedFindingUserName\\\"]},\\\"sample\\\":true}\",\"type\":\"default\"},\"eventFirstSeen\":\"2023-03-20T15:33:12.000Z\",\"eventLastSeen\":\"2023-03-20T15:33:12.000Z\",\"archived\":false,\"count\":1},\"severity\":8,\"createdAt\":\"2023-03-20T15:33:12.393Z\",\"updatedAt\":\"2023-03-20T15:33:12.393Z\",\"title\":\"Resource discovery API GeneratedFindingAPIName was invoked from an IP address on a custom threat list.\",\"description\":\"An API commonly used in resource discovery was used to access a bucket from an IP address on a custom threat list. Unauthorized actors perform such activity to gather information about your Amazon S3 buckets and objects in order to further tailor the attack.\"}"
  },
  "expected": {
    "message": "{\"schemaVersion\":\"2.0\",\"accountId\":\"111111111111\",\"region\":\"eu-west-2\",\"partition\":\"aws\",\"id\":\"3941673a580340dcb61648a3e15def75\",\"arn\":\"arn:aws:guardduty:eu-west-2:111111111111:detector/4b85f358-65e7-49b6-b9ae-b3816303fb12/finding/3941673a580340dcb61648a3e15def75\",\"type\":\"Discovery:S3/MaliciousIPCaller.Custom\",\"resource\":{\"resourceType\":\"S3Bucket\",\"accessKeyDetails\":{\"accessKeyId\":\"GeneratedFindingAccessKeyId\",\"principalId\":\"GeneratedFindingPrincipalId\",\"userType\":\"IAMUser\",\"userName\":\"GeneratedFindingUserName\"},\"s3BucketDetails\":[{\"arn\":\"arn:aws:s3:::bucketName\",\"name\":\"bucketName\",\"type\":\"Destination\",\"createdAt\":1.513612691551E9,\"owner\":{\"id\":\"CanonicalId of Owner\"},\"tags\":[{\"key\":\"foo\",\"value\":\"bar\"}],\"defaultServerSideEncryption\":{\"encryptionType\":\"SSEAlgorithm\",\"kmsMasterKeyArn\":\"arn:aws:kms:region:123456789012:key/key-id\"},\"publicAccess\":{\"permissionConfiguration\":{\"bucketLevelPermissions\":{\"accessControlList\":{\"allowsPublicReadAccess\":false,\"allowsPublicWriteAccess\":false},\"bucketPolicy\":{\"allowsPublicReadAccess\":false,\"allowsPublicWriteAccess\":false},\"blockPublicAccess\":{\"ignorePublicAcls\":false,\"restrictPublicBuckets\":false,\"blockPublicAcls\":false,\"blockPublicPolicy\":false}},\"accountLevelPermissions\":{\"blockPublicAccess\":{\"ignorePublicAcls\":false,\"restrictPublicBuckets\":false,\"blockPublicAcls\":false,\"blockPublicPolicy\":false}}},\"effectivePermission\":\"NOT_PUBLIC\"}}],\"instanceDetails\":{\"instanceId\":\"i-99999999\",\"instanceType\":\"m3.xlarge\",\"outpostArn\":\"arn:aws:outposts:us-west-2:123456789000:outpost/op-0fbc006e9abbc73c3\",\"launchTime\":\"2016-08-02T02:05:06.000Z\",\"platform\":null,\"productCodes\":[{\"productCodeId\":\"GeneratedFindingProductCodeId\",\"productCodeType\":\"GeneratedFindingProductCodeType\"}],\"iamInstanceProfile\":{\"arn\":\"arn:aws:iam::111111111111:example/instance/profile\",\"id\":\"GeneratedFindingInstanceProfileId\"},\"networkInterfaces\":[{\"ipv6Addresses\":[],\"networkInterfaceId\":\"eni-bfcffe88\",\"privateDnsName\":\"GeneratedFindingPrivateDnsName\",\"privateIpAddress\":\"10.0.0.1\",\"privateIpAddresses\":[{\"privateDnsName\":\"GeneratedFindingPrivateName\",\"privateIpAddress\":\"10.0.0.1\"}],\"subnetId\":\"GeneratedFindingSubnetId\",\"vpcId\":\"GeneratedFindingVPCId\",\"securityGroups\":[{\"groupName\":\"GeneratedFindingSecurityGroupName\",\"groupId\":\"GeneratedFindingSecurityId\"}],\"publicDnsName\":\"GeneratedFindingPublicDNSName\",\"publicIp\":\"198.51.100.0\"}],\"tags\":[{\"key\":\"GeneratedFindingInstaceTag1\",\"value\":\"GeneratedFindingInstaceValue1\"},{\"key\":\"GeneratedFindingInstaceTag2\",\"value\":\"GeneratedFindingInstaceTagValue2\"},{\"key\":\"GeneratedFindingInstaceTag3\",\"value\":\"GeneratedFindingInstaceTagValue3\"},{\"key\":\"GeneratedFindingInstaceTag4\",\"value\":\"GeneratedFindingInstaceTagValue4\"},{\"key\":\"GeneratedFindingInstaceTag5\",\"value\":\"GeneratedFindingInstaceTagValue5\"},{\"key\":\"GeneratedFindingInstaceTag6\",\"value\":\"GeneratedFindingInstaceTagValue6\"},{\"key\":\"GeneratedFindingInstaceTag7\",\"value\":\"GeneratedFindingInstaceTagValue7\"},{\"key\":\"GeneratedFindingInstaceTag8\",\"value\":\"GeneratedFindingInstaceTagValue8\"},{\"key\":\"GeneratedFindingInstaceTag9\",\"value\":\"GeneratedFindingInstaceTagValue9\"}],\"instanceState\":\"running\",\"availabilityZone\":\"GeneratedFindingInstaceAvailabilityZone\",\"imageId\":\"ami-99999999\",\"imageDescription\":\"GeneratedFindingInstaceImageDescription\"}},\"service\":{\"serviceName\":\"guardduty\",\"detectorId\":\"4b85f358-65e7-49b6-b9ae-b3816303fb12\",\"action\":{\"actionType\":\"AWS_API_CALL\",\"awsApiCallAction\":{\"api\":\"GeneratedFindingAPIName\",\"serviceName\":\"GeneratedFindingAPIServiceName\",\"callerType\":\"Remote IP\",\"errorCode\":\"AccessDenied\",\"remoteIpDetails\":{\"ipAddressV4\":\"198.51.100.0\",\"organization\":{\"asn\":\"-1\",\"asnOrg\":\"GeneratedFindingASNOrg\",\"isp\":\"GeneratedFindingISP\",\"org\":\"GeneratedFindingORG\"},\"country\":{\"countryName\":\"GeneratedFindingCountryName\"},\"city\":{\"cityName\":\"GeneratedFindingCityName\"},\"geoLocation\":{\"lat\":0,\"lon\":0}},\"affectedResources\":{\"AWS::S3::Bucket\":\"GeneratedFindingS3Bucket\"}}},\"resourceRole\":\"TARGET\",\"additionalInfo\":{\"unusual\":{\"hoursOfDay\":[1513609200000],\"userNames\":[\"GeneratedFindingUserName\"]},\"sample\":true,\"value\":\"{\\\"unusual\\\":{\\\"hoursOfDay\\\":[1513609200000],\\\"userNames\\\":[\\\"GeneratedFindingUserName\\\"]},\\\"sample\\\":true}\",\"type\":\"default\"},\"eventFirstSeen\":\"2023-03-20T15:33:12.000Z\",\"eventLastSeen\":\"2023-03-20T15:33:12.000Z\",\"archived\":false,\"count\":1},\"severity\":8,\"createdAt\":\"2023-03-20T15:33:12.393Z\",\"updatedAt\":\"2023-03-20T15:33:12.393Z\",\"title\":\"Resource discovery API GeneratedFindingAPIName was invoked from an IP address on a custom threat list.\",\"description\":\"An API commonly used in resource discovery was used to access a bucket from an IP address on a custom threat list. Unauthorized actors perform such activity to gather information about your Amazon S3 buckets and objects in order to further tailor the attack.\"}",
    "event": {
      "action": "Discovery",
      "category": [
        "threat"
      ],
      "kind": "alert",
      "severity": 8,
      "type": [
        "indicator"
      ]
    },
    "@timestamp": "2023-03-20T15:33:12.393000Z",
    "agent": {
      "version": "2.0"
    },
    "aws": {
      "guardduty": {
        "finding": {
          "accesskey": {
            "accessKeyId": "GeneratedFindingAccessKeyId",
            "principalId": "GeneratedFindingPrincipalId",
            "userType": "IAMUser"
          },
          "id": "3941673a580340dcb61648a3e15def75",
          "principal": {
            "id": "GeneratedFindingPrincipalId"
          },
          "region": "eu-west-2",
          "s3bucket": {
            "arn": "arn:aws:s3:::bucketName",
            "createdAt": 1513612691.551,
            "defaultServerSideEncryption": {
              "encryptionType": "SSEAlgorithm",
              "kmsMasterKeyArn": "arn:aws:kms:region:123456789012:key/key-id"
            },
            "name": "bucketName",
            "owner": {
              "id": "CanonicalId of Owner"
            },
            "type": "Destination"
          },
          "service": {
            "action": {
              "type": "AWS_API_CALL"
            }
          },
          "type": "Discovery:S3/MaliciousIPCaller.Custom"
        }
      }
    },
    "cloud": {
      "account": {
        "id": "111111111111"
      },
      "instance": {
        "id": "i-99999999"
      },
      "machine": {
        "type": "m3.xlarge"
      },
      "provider": "aws",
      "region": "eu-west-2"
    },
    "error": {
      "code": "AccessDenied"
    },
    "related": {
      "ip": [
        "198.51.100.0"
      ],
      "user": [
        "GeneratedFindingUserName"
      ]
    },
    "service": {
      "name": "GeneratedFindingAPIServiceName"
    },
    "source": {
      "address": "198.51.100.0",
      "geo": {
        "city_name": "GeneratedFindingCityName",
        "country_name": "GeneratedFindingCountryName",
        "location": {
          "lat": 0,
          "lon": 0
        }
      },
      "ip": "198.51.100.0"
    },
    "threat": {
      "enrichments": [
        {
          "indicator": {
            "first_seen": "2023-03-20T15:33:12.000Z",
            "last_seen": "2023-03-20T15:33:12.000Z",
            "sightings": "1"
          }
        }
      ],
      "group": {
        "name": "MaliciousIPCaller"
      },
      "indicator": {
        "description": "An API commonly used in resource discovery was used to access a bucket from an IP address on a custom threat list. Unauthorized actors perform such activity to gather information about your Amazon S3 buckets and objects in order to further tailor the attack."
      }
    },
    "user": {
      "name": "GeneratedFindingUserName"
    }
  }
}