{
  "input": {
    "message": "{\"src.process.parent.isStorylineRoot\":true,\"event.category\":\"command_script\",\"tgt.file.modificationTime\":-11644473600000,\"osSrc.process.parent.sessionId\":0,\"src.process.parent.image.sha1\":\"9b77e09375790ea1ea0a9ca9fc1d69e8e32fe597\",\"site.id\":\"1640744535583677559\",\"tgt.file.location\":\"Local\",\"src.process.parent.displayName\":\"Host Process for Windows Tasks\",\"src.process.image.binaryIsExecutable\":true,\"osSrc.process.parent.image.sha1\":\"1bc5066ddf693fc034d6514618854e26a84fd0d1\",\"osSrc.process.parent.name\":\"svchost.exe\",\"src.process.parent.subsystem\":\"SYS_WIN32\",\"src.process.user\":\"desktop-jdoe\\\\john.doe\",\"src.process.indicatorRansomwareCount\":0,\"osSrc.process.parent.startTime\":1680169387386,\"src.process.crossProcessDupRemoteProcessHandleCount\":0,\"src.process.tgtFileCreationCount\":0,\"src.process.indicatorInjectionCount\":0,\"src.process.moduleCount\":272,\"src.process.parent.name\":\"taskhostw.exe\",\"i.version\":\"preprocess-lib-1.0\",\"sca:atlantisIngestTime\":1680184001306,\"src.process.image.md5\":\"e610d62f73d68a280d364d1ccd6fea30\",\"src.process.indicatorReconnaissanceCount\":5,\"src.process.storyline.id\":\"3ED9E6E7AB538ED5\",\"src.process.childProcCount\":1,\"mgmt.url\":\"euce1-105.sentinelone.net\",\"src.process.crossProcessOpenProcessCount\":0,\"cmdScript.isComplete\":true,\"src.process.subsystem\":\"SYS_WIN32\",\"meta.event.name\":\"SCRIPTS\",\"src.process.parent.integrityLevel\":\"HIGH\",\"osSrc.process.parent.cmdline\":\"C:\\\\Windows\\\\system32\\\\svchost.exe -k DcomLaunch -p\",\"osSrc.process.parent.image.md5\":\"b7f884c1b74a263f746ee12a5f7c9f6a\",\"src.process.indicatorExploitationCount\":0,\"src.process.parent.storyline.id\":\"3ED9E6E7AB538ED5\",\"tgt.file.creationTime\":-11644473600000,\"src.process.integrityLevel\":\"HIGH\",\"i.scheme\":\"edr\",\"site.name\":\"Default site\",\"src.process.netConnInCount\":0,\"event.time\":1680183967040,\"osSrc.process.parent.isStorylineRoot\":true,\"timestamp\":\"2023-03-30T13:46:07.040Z\",\"account.id\":\"1640744534476381289\",\"dataSource.name\":\"SentinelOne\",\"endpoint.name\":\"desktop-jdoe\",\"tgt.file.size\":2593,\"src.process.image.sha1\":\"9b1d2f446cdb7d412775dffe05ebf35db5f12ccd\",\"src.process.isStorylineRoot\":false,\"cmdScript.applicationName\":\"PowerShell_C:\\\\Windows\\\\System32\\\\sdiagnhost.exe_10.0.19041.1\",\"src.process.parent.image.path\":\"C:\\\\Windows\\\\System32\\\\taskhostw.exe\",\"tgt.file.sha1\":\"6f8e508526af2f5a9ab618ebb26b140e8b2811b4\",\"dataSource.vendor\":\"SentinelOne\",\"src.process.pid\":7488,\"osSrc.process.parent.integrityLevel\":\"SYSTEM\",\"tgt.file.isSigned\":\"signed\",\"src.process.cmdline\":\"C:\\\\Windows\\\\System32\\\\sdiagnhost.exe -Embedding\",\"src.process.publisher\":\"MICROSOFT WINDOWS\",\"sca:ingestTime\":1680184006,\"dataSource.category\":\"security\",\"src.process.crossProcessThreadCreateCount\":0,\"src.process.parent.isNative64Bit\":false,\"src.process.parent.isRedirectCmdProcessor\":false,\"osSrc.process.parent.image.path\":\"C:\\\\Windows\\\\System32\\\\svchost.exe\",\"src.process.crossProcessCount\":0,\"src.process.signedStatus\":\"signed\",\"osSrc.process.parent.signedStatus\":\"signed\",\"tgt.file.isExecutable\":false,\"event.id\":\"01GWSCAFNK8CGJZYXP5JNDA8VW_166\",\"src.process.parent.cmdline\":\"taskhostw.exe\",\"osSrc.process.parent.displayName\":\"Host Process for Windows Services\",\"cmdScript.content\":\"{(Format-DiskSpaceMB $_.Space) + \\\"MB\\\"}\",\"src.process.image.path\":\"C:\\\\Windows\\\\System32\\\\sdiagnhost.exe\",\"src.process.tgtFileModificationCount\":2,\"src.process.indicatorEvasionCount\":0,\"src.process.netConnOutCount\":0,\"tgt.file.path\":\"C:\\\\Windows\\\\Temp\\\\SDIAG_a0e33bf6-3533-4a09-9528-c8c20ec69f57\\\\TS_DiagnosticHistory.ps1\",\"cmdScript.sha256\":\"6f7db8ffe9379313fda22bcf6b6888ca8405dbab4a6ee58504b2bb34cda3def6\",\"tgt.file.extension\":\"ps1\",\"src.process.crossProcessDupThreadHandleCount\":0,\"endpoint.os\":\"windows\",\"src.process.tgtFileDeletionCount\":0,\"src.process.startTime\":1680183962201,\"mgmt.id\":\"16964\",\"os.name\":\"Windows 10 Pro\",\"tgt.file.type\":\"UNKNOWN\",\"osSrc.process.parent.isNative64Bit\":false,\"src.process.displayName\":\"Scripted Diagnostics Native Host\",\"tgt.file.sha256\":\"00915c9baba87359a458d23e18f412647852a3260280a0d64af5e91307c01bce\",\"src.process.parent.sessionId\":2,\"src.process.isNative64Bit\":false,\"src.process.uid\":\"64D9E6E7AB538ED5\",\"src.process.parent.image.md5\":\"a00bf82660835224cd6606a248321c5d\",\"osSrc.process.parent.publisher\":\"MICROSOFT WINDOWS\",\"osSrc.process.parent.isRedirectCmdProcessor\":false,\"src.process.indicatorBootConfigurationUpdateCount\":0,\"src.process.indicatorInfostealerCount\":0,\"process.unique.key\":\"64D9E6E7AB538ED5\",\"cmdScript.originalSize\":76,\"osSrc.process.parent.storyline.id\":\"0F91E6E7AB538ED5\",\"osSrc.process.parent.pid\":832,\"src.process.parent.uid\":\"3DD9E6E7AB538ED5\",\"agent.version\":\"22.3.2.373\",\"src.process.parent.image.sha256\":\"e63709209d09bc0247e785f075ddb28a98c348206109e2b8ba321ad958402728\",\"src.process.sessionId\":2,\"src.process.netConnCount\":0,\"mgmt.osRevision\":\"19044\",\"group.id\":\"3ED9E6E7AB538ED5\",\"src.process.parent.publisher\":\"MICROSOFT WINDOWS\",\"src.process.isRedirectCmdProcessor\":false,\"src.process.verifiedStatus\":\"verified\",\"src.process.parent.startTime\":1680183961002,\"src.process.dnsCount\":0,\"endpoint.type\":\"desktop\",\"trace.id\":\"01GWSCAFNK8CGJZYXP5JNDA8VW\",\"src.process.name\":\"sdiagnhost.exe\",\"tgt.file.md5\":\"6f42efe37f2f73bc4d5531a5906844c5\",\"agent.uuid\":\"9a25d24fd1e4418dab8e358865fa1e29\",\"osSrc.process.parent.image.sha256\":\"add683a6910abbbf0e28b557fad0ba998166394932ae2aca069d9aa19ea8fe88\",\"src.process.image.sha256\":\"e5ec6b5b20a16383cc953ad5e478dcdf95ba46281f4fe971673c954d4145c0c4\",\"osSrc.process.parent.user\":\"NT AUTHORITY\\\\SYSTEM\",\"src.process.indicatorGeneralCount\":4,\"src.process.crossProcessOutOfStorylineCount\":0,\"src.process.registryChangeCount\":0,\"packet.id\":\"7F72001C135D479586722BA2913C81E1\",\"src.process.indicatorPersistenceCount\":0,\"src.process.parent.signedStatus\":\"signed\",\"src.process.parent.user\":\"desktop-jdoe\\\\john.doe\",\"tgt.file.id\":\"59D9E6E7AB538ED5\",\"osSrc.process.parent.uid\":\"0E91E6E7AB538ED5\",\"event.type\":\"Command Script\",\"task.path\":\"C:\\\\Windows\\\\Temp\\\\SDIAG_a0e33bf6-3533-4a09-9528-c8c20ec69f57\\\\TS_DiagnosticHistory.ps1\",\"src.process.indicatorPostExploitationCount\":0,\"src.process.parent.pid\":6276}"
  },
  "expected": {
    "message": "{\"src.process.parent.isStorylineRoot\":true,\"event.category\":\"command_script\",\"tgt.file.modificationTime\":-11644473600000,\"osSrc.process.parent.sessionId\":0,\"src.process.parent.image.sha1\":\"9b77e09375790ea1ea0a9ca9fc1d69e8e32fe597\",\"site.id\":\"1640744535583677559\",\"tgt.file.location\":\"Local\",\"src.process.parent.displayName\":\"Host Process for Windows Tasks\",\"src.process.image.binaryIsExecutable\":true,\"osSrc.process.parent.image.sha1\":\"1bc5066ddf693fc034d6514618854e26a84fd0d1\",\"osSrc.process.parent.name\":\"svchost.exe\",\"src.process.parent.subsystem\":\"SYS_WIN32\",\"src.process.user\":\"desktop-jdoe\\\\john.doe\",\"src.process.indicatorRansomwareCount\":0,\"osSrc.process.parent.startTime\":1680169387386,\"src.process.crossProcessDupRemoteProcessHandleCount\":0,\"src.process.tgtFileCreationCount\":0,\"src.process.indicatorInjectionCount\":0,\"src.process.moduleCount\":272,\"src.process.parent.name\":\"taskhostw.exe\",\"i.version\":\"preprocess-lib-1.0\",\"sca:atlantisIngestTime\":1680184001306,\"src.process.image.md5\":\"e610d62f73d68a280d364d1ccd6fea30\",\"src.process.indicatorReconnaissanceCount\":5,\"src.process.storyline.id\":\"3ED9E6E7AB538ED5\",\"src.process.childProcCount\":1,\"mgmt.url\":\"euce1-105.sentinelone.net\",\"src.process.crossProcessOpenProcessCount\":0,\"cmdScript.isComplete\":true,\"src.process.subsystem\":\"SYS_WIN32\",\"meta.event.name\":\"SCRIPTS\",\"src.process.parent.integrityLevel\":\"HIGH\",\"osSrc.process.parent.cmdline\":\"C:\\\\Windows\\\\system32\\\\svchost.exe -k DcomLaunch -p\",\"osSrc.process.parent.image.md5\":\"b7f884c1b74a263f746ee12a5f7c9f6a\",\"src.process.indicatorExploitationCount\":0,\"src.process.parent.storyline.id\":\"3ED9E6E7AB538ED5\",\"tgt.file.creationTime\":-11644473600000,\"src.process.integrityLevel\":\"HIGH\",\"i.scheme\":\"edr\",\"site.name\":\"Default site\",\"src.process.netConnInCount\":0,\"event.time\":1680183967040,\"osSrc.process.parent.isStorylineRoot\":true,\"timestamp\":\"2023-03-30T13:46:07.040Z\",\"account.id\":\"1640744534476381289\",\"dataSource.name\":\"SentinelOne\",\"endpoint.name\":\"desktop-jdoe\",\"tgt.file.size\":2593,\"src.process.image.sha1\":\"9b1d2f446cdb7d412775dffe05ebf35db5f12ccd\",\"src.process.isStorylineRoot\":false,\"cmdScript.applicationName\":\"PowerShell_C:\\\\Windows\\\\System32\\\\sdiagnhost.exe_10.0.19041.1\",\"src.process.parent.image.path\":\"C:\\\\Windows\\\\System32\\\\taskhostw.exe\",\"tgt.file.sha1\":\"6f8e508526af2f5a9ab618ebb26b140e8b2811b4\",\"dataSource.vendor\":\"SentinelOne\",\"src.process.pid\":7488,\"osSrc.process.parent.integrityLevel\":\"SYSTEM\",\"tgt.file.isSigned\":\"signed\",\"src.process.cmdline\":\"C:\\\\Windows\\\\System32\\\\sdiagnhost.exe -Embedding\",\"src.process.publisher\":\"MICROSOFT WINDOWS\",\"sca:ingestTime\":1680184006,\"dataSource.category\":\"security\",\"src.process.crossProcessThreadCreateCount\":0,\"src.process.parent.isNative64Bit\":false,\"src.process.parent.isRedirectCmdProcessor\":false,\"osSrc.process.parent.image.path\":\"C:\\\\Windows\\\\System32\\\\svchost.exe\",\"src.process.crossProcessCount\":0,\"src.process.signedStatus\":\"signed\",\"osSrc.process.parent.signedStatus\":\"signed\",\"tgt.file.isExecutable\":false,\"event.id\":\"01GWSCAFNK8CGJZYXP5JNDA8VW_166\",\"src.process.parent.cmdline\":\"taskhostw.exe\",\"osSrc.process.parent.displayName\":\"Host Process for Windows Services\",\"cmdScript.content\":\"{(Format-DiskSpaceMB $_.Space) + \\\"MB\\\"}\",\"src.process.image.path\":\"C:\\\\Windows\\\\System32\\\\sdiagnhost.exe\",\"src.process.tgtFileModificationCount\":2,\"src.process.indicatorEvasionCount\":0,\"src.process.netConnOutCount\":0,\"tgt.file.path\":\"C:\\\\Windows\\\\Temp\\\\SDIAG_a0e33bf6-3533-4a09-9528-c8c20ec69f57\\\\TS_DiagnosticHistory.ps1\",\"cmdScript.sha256\":\"6f7db8ffe9379313fda22bcf6b6888ca8405dbab4a6ee58504b2bb34cda3def6\",\"tgt.file.extension\":\"ps1\",\"src.process.crossProcessDupThreadHandleCount\":0,\"endpoint.os\":\"windows\",\"src.process.tgtFileDeletionCount\":0,\"src.process.startTime\":1680183962201,\"mgmt.id\":\"16964\",\"os.name\":\"Windows 10 Pro\",\"tgt.file.type\":\"UNKNOWN\",\"osSrc.process.parent.isNative64Bit\":false,\"src.process.displayName\":\"Scripted Diagnostics Native Host\",\"tgt.file.sha256\":\"00915c9baba87359a458d23e18f412647852a3260280a0d64af5e91307c01bce\",\"src.process.parent.sessionId\":2,\"src.process.isNative64Bit\":false,\"src.process.uid\":\"64D9E6E7AB538ED5\",\"src.process.parent.image.md5\":\"a00bf82660835224cd6606a248321c5d\",\"osSrc.process.parent.publisher\":\"MICROSOFT WINDOWS\",\"osSrc.process.parent.isRedirectCmdProcessor\":false,\"src.process.indicatorBootConfigurationUpdateCount\":0,\"src.process.indicatorInfostealerCount\":0,\"process.unique.key\":\"64D9E6E7AB538ED5\",\"cmdScript.originalSize\":76,\"osSrc.process.parent.storyline.id\":\"0F91E6E7AB538ED5\",\"osSrc.process.parent.pid\":832,\"src.process.parent.uid\":\"3DD9E6E7AB538ED5\",\"agent.version\":\"22.3.2.373\",\"src.process.parent.image.sha256\":\"e63709209d09bc0247e785f075ddb28a98c348206109e2b8ba321ad958402728\",\"src.process.sessionId\":2,\"src.process.netConnCount\":0,\"mgmt.osRevision\":\"19044\",\"group.id\":\"3ED9E6E7AB538ED5\",\"src.process.parent.publisher\":\"MICROSOFT WINDOWS\",\"src.process.isRedirectCmdProcessor\":false,\"src.process.verifiedStatus\":\"verified\",\"src.process.parent.startTime\":1680183961002,\"src.process.dnsCount\":0,\"endpoint.type\":\"desktop\",\"trace.id\":\"01GWSCAFNK8CGJZYXP5JNDA8VW\",\"src.process.name\":\"sdiagnhost.exe\",\"tgt.file.md5\":\"6f42efe37f2f73bc4d5531a5906844c5\",\"agent.uuid\":\"9a25d24fd1e4418dab8e358865fa1e29\",\"osSrc.process.parent.image.sha256\":\"add683a6910abbbf0e28b557fad0ba998166394932ae2aca069d9aa19ea8fe88\",\"src.process.image.sha256\":\"e5ec6b5b20a16383cc953ad5e478dcdf95ba46281f4fe971673c954d4145c0c4\",\"osSrc.process.parent.user\":\"NT AUTHORITY\\\\SYSTEM\",\"src.process.indicatorGeneralCount\":4,\"src.process.crossProcessOutOfStorylineCount\":0,\"src.process.registryChangeCount\":0,\"packet.id\":\"7F72001C135D479586722BA2913C81E1\",\"src.process.indicatorPersistenceCount\":0,\"src.process.parent.signedStatus\":\"signed\",\"src.process.parent.user\":\"desktop-jdoe\\\\john.doe\",\"tgt.file.id\":\"59D9E6E7AB538ED5\",\"osSrc.process.parent.uid\":\"0E91E6E7AB538ED5\",\"event.type\":\"Command Script\",\"task.path\":\"C:\\\\Windows\\\\Temp\\\\SDIAG_a0e33bf6-3533-4a09-9528-c8c20ec69f57\\\\TS_DiagnosticHistory.ps1\",\"src.process.indicatorPostExploitationCount\":0,\"src.process.parent.pid\":6276}",
    "event": {
      "action": "Command Script",
      "category": [
        "process"
      ],
      "dataset": "cloud-funnel-2.0",
      "type": [
        "info"
      ]
    },
    "@timestamp": "2023-03-30T13:46:07.040000Z",
    "action": {
      "properties": {
        "ScriptBlockText": "{(Format-DiskSpaceMB $_.Space) + \"MB\"}"
      }
    },
    "agent": {
      "version": "22.3.2.373"
    },
    "deepvisibility": {
      "agent": {
        "managment_url": "euce1-105.sentinelone.net",
        "trace_id": "01GWSCAFNK8CGJZYXP5JNDA8VW",
        "uuid": "9a25d24fd1e4418dab8e358865fa1e29"
      },
      "event": {
        "category": "command_script",
        "type": "Command Script"
      },
      "host": {
        "os": {
          "revision": "19044"
        }
      },
      "process": {
        "ossrc": {
          "parent": {
            "storyline_id": "0F91E6E7AB538ED5"
          }
        },
        "parent": {
          "command_line": "taskhostw.exe",
          "executable": {
            "name": "C:\\Windows\\System32\\taskhostw.exe"
          },
          "storyline_id": "3ED9E6E7AB538ED5"
        },
        "storyline_id": "3ED9E6E7AB538ED5"
      },
      "script": {
        "app_name": "PowerShell_C:\\Windows\\System32\\sdiagnhost.exe_10.0.19041.1",
        "content": "{(Format-DiskSpaceMB $_.Space) + \"MB\"}"
      }
    },
    "file": {
      "code_signature": {
        "exists": false
      },
      "created": "1966-04-24T06:14:24Z",
      "directory": "C:\\Windows\\Temp\\SDIAG_a0e33bf6-3533-4a09-9528-c8c20ec69f57",
      "hash": {
        "md5": "6f42efe37f2f73bc4d5531a5906844c5",
        "sha1": "6f8e508526af2f5a9ab618ebb26b140e8b2811b4",
        "sha256": "6f7db8ffe9379313fda22bcf6b6888ca8405dbab4a6ee58504b2bb34cda3def6"
      },
      "mtime": "1966-04-24T06:14:24Z",
      "name": "TS_DiagnosticHistory.ps1",
      "path": "C:\\Windows\\Temp\\SDIAG_a0e33bf6-3533-4a09-9528-c8c20ec69f57\\TS_DiagnosticHistory.ps1",
      "size": 76
    },
    "host": {
      "name": "desktop-jdoe",
      "os": {
        "family": "windows",
        "name": "Windows 10 Pro",
        "type": "windows"
      },
      "type": "desktop"
    },
    "observer": {
      "vendor": "SentinelOne"
    },
    "process": {
      "code_signature": {
        "exists": true,
        "subject_name": "MICROSOFT WINDOWS"
      },
      "command_line": "C:\\Windows\\System32\\sdiagnhost.exe -Embedding",
      "executable": "C:\\Windows\\System32\\sdiagnhost.exe",
      "hash": {
        "md5": "e610d62f73d68a280d364d1ccd6fea30",
        "sha1": "9b1d2f446cdb7d412775dffe05ebf35db5f12ccd",
        "sha256": "e5ec6b5b20a16383cc953ad5e478dcdf95ba46281f4fe971673c954d4145c0c4"
      },
      "name": "sdiagnhost.exe",
      "parent": {
        "code_signature": {
          "exists": true,
          "subject_name": "MICROSOFT WINDOWS"
        },
        "command_line": "C:\\Windows\\system32\\svchost.exe -k DcomLaunch -p",
        "executable": "C:\\Windows\\System32\\svchost.exe",
        "hash": {
          "md5": "b7f884c1b74a263f746ee12a5f7c9f6a",
          "sha1": "1bc5066ddf693fc034d6514618854e26a84fd0d1",
          "sha256": "add683a6910abbbf0e28b557fad0ba998166394932ae2aca069d9aa19ea8fe88"
        },
        "name": "svchost.exe",
        "process": {
          "pid": "832"
        },
        "start": "2023-03-30T09:43:07.386000Z",
        "title": "Host Process for Windows Services",
        "user": {
          "name": "NT AUTHORITY\\SYSTEM"
        },
        "working_directory": "C:\\Windows\\System32"
      },
      "pid": 7488,
      "start": "2023-03-30T13:46:02.201000Z",
      "title": "Scripted Diagnostics Native Host",
      "user": {
        "name": "desktop-jdoe\\john.doe"
      },
      "working_directory": "C:\\Windows\\System32"
    },
    "related": {
      "hash": [
        "1bc5066ddf693fc034d6514618854e26a84fd0d1",
        "6f42efe37f2f73bc4d5531a5906844c5",
        "6f7db8ffe9379313fda22bcf6b6888ca8405dbab4a6ee58504b2bb34cda3def6",
        "6f8e508526af2f5a9ab618ebb26b140e8b2811b4",
        "9b1d2f446cdb7d412775dffe05ebf35db5f12ccd",
        "add683a6910abbbf0e28b557fad0ba998166394932ae2aca069d9aa19ea8fe88",
        "b7f884c1b74a263f746ee12a5f7c9f6a",
        "e5ec6b5b20a16383cc953ad5e478dcdf95ba46281f4fe971673c954d4145c0c4",
        "e610d62f73d68a280d364d1ccd6fea30"
      ],
      "user": [
        "john.doe"
      ]
    },
    "user": {
      "domain": "desktop-jdoe",
      "name": "john.doe"
    }
  }
}