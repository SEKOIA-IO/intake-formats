{
  "input": {
    "message": "{\"src.process.parent.isStorylineRoot\": false, \"event.category\": \"command_script\", \"tgt.file.modificationTime\": -11644473600000, \"src.process.parent.image.sha1\": \"99ae9c73e9bee6f9c76d6f4093a9882df06832cf\", \"site.id\": \"1470095163515336467\", \"src.process.image.binaryIsExecutable\": true, \"src.process.parent.displayName\": \"Windows Command Processor\", \"src.process.user\": \"AUTORITE NT\\\\Syst\\u00e8me\", \"src.process.parent.subsystem\": \"SYS_WIN32\", \"src.process.indicatorRansomwareCount\": 0, \"src.process.crossProcessDupRemoteProcessHandleCount\": 7, \"src.process.activeContent.signedStatus\": \"unsigned\", \"src.process.tgtFileCreationCount\": 0, \"src.process.indicatorInjectionCount\": 0, \"src.process.moduleCount\": 1800, \"i.version\": \"preprocess-lib-1.0\", \"src.process.parent.name\": \"cmd.exe\", \"src.process.activeContentType\": \"FILE\", \"src.process.parent.activeContent.id\": \"3EFA3EFA3EFA3EFA\", \"src.process.image.md5\": \"097ce5761c89434367598b34fe32893b\", \"src.process.storyline.id\": \"7FABCCD60C10799B\", \"src.process.indicatorReconnaissanceCount\": 69, \"src.process.childProcCount\": 6, \"mgmt.url\": \"euce1-sns-mssp.sentinelone.net\", \"src.process.crossProcessOpenProcessCount\": 0, \"cmdScript.isComplete\": true, \"src.process.subsystem\": \"SYS_WIN32\", \"meta.event.name\": \"SCRIPTS\", \"src.process.parent.integrityLevel\": \"SYSTEM\", \"src.process.indicatorExploitationCount\": 0, \"src.process.parent.storyline.id\": \"7FABCCD60C10799B\", \"tgt.file.creationTime\": -11644473600000, \"src.process.integrityLevel\": \"SYSTEM\", \"i.scheme\": \"edr\", \"site.name\": \"Default site\", \"src.process.netConnInCount\": 0, \"event.time\": 1722588221803, \"timestamp\": \"2024-08-02T08:43:41.803Z\", \"account.id\": \"1470095162995242762\", \"dataSource.name\": \"SentinelOne\", \"endpoint.name\": \"ntrsql15\", \"src.process.image.sha1\": \"044a0cf1f6bc478a7172bf207eef1e201a18ba02\", \"tgt.file.size\": 50105, \"cmdScript.applicationName\": \"PowerShell_C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe_10.0.14393.0\", \"src.process.isStorylineRoot\": false, \"src.process.parent.image.path\": \"C:\\\\Windows\\\\System32\\\\cmd.exe\", \"tgt.file.sha1\": \"4b09001438b32e54b91cbe27685c75a316f8cdf5\", \"dataSource.vendor\": \"SentinelOne\", \"src.process.pid\": 3744, \"src.process.parent.activeContent.hash\": \"1b11fdf894b9a205b690add505ff5f2193c1fe48\", \"tgt.file.isSigned\": \"signed\", \"src.process.cmdline\": \"powershell  -executionpolicy bypass -file \\\"c:\\\\zabbix\\\\scripts\\\\sb.mssql.ps1\\\" poller RUIWS01 \", \"src.process.publisher\": \"MICROSOFT WINDOWS\", \"dataSource.category\": \"security\", \"src.process.crossProcessThreadCreateCount\": 0, \"src.process.parent.isNative64Bit\": false, \"src.process.parent.activeContentType\": \"CLI\", \"src.process.parent.isRedirectCmdProcessor\": false, \"src.process.parent.activeContent.path\": \"\\\\\\\\Unknown device\\\\Unknown file\", \"src.process.crossProcessCount\": 7, \"src.process.signedStatus\": \"signed\", \"tgt.file.isExecutable\": false, \"event.id\": \"01J4945B0JAAYZXWF8ZG4A0VMZ_638\", \"src.process.parent.cmdline\": \"cmd /C \\\"powershell -executionpolicy bypass -file \\\"c:\\\\zabbix\\\\scripts\\\\sb.mssql.ps1\\\" poller RUIWS01  \\\"\", \"cmdScript.content\": \"{ updateInfo_Serveurs -instance_name $instance -datas_res $res_infos }\", \"src.process.image.path\": \"C:\\\\Windows\\\\System32\\\\WINDOWSPOWERSHELL\\\\V1.0\\\\powershell.EXE\", \"src.process.tgtFileModificationCount\": 21, \"src.process.indicatorEvasionCount\": 101, \"src.process.netConnOutCount\": 0, \"cmdScript.sha256\": \"b285d770802aac13330fd7d2a0ade3c9a7adf575d160a81dfc30614c7a89e775\", \"tgt.file.path\": \"C:\\\\zabbix\\\\scripts\\\\sb.mssql.ps1\", \"tgt.file.extension\": \"ps1\", \"src.process.crossProcessDupThreadHandleCount\": 0, \"endpoint.os\": \"windows\", \"src.process.tgtFileDeletionCount\": 0, \"src.process.startTime\": 1722588220577, \"mgmt.id\": \"16205\", \"os.name\": \"Windows Server 2016 Standard\", \"tgt.file.type\": \"UNKNOWN\", \"src.process.activeContent.id\": \"B76839D30C10799B\", \"src.process.displayName\": \"Windows PowerShell\", \"src.process.activeContent.path\": \"C:\\\\zabbix\\\\scripts\\\\sb.mssql.ps1\", \"src.process.isNative64Bit\": false, \"src.process.parent.sessionId\": 0, \"src.process.uid\": \"07AED4D60C10799B\", \"src.process.parent.image.md5\": \"f4f684066175b77e0c3a000549d2922c\", \"src.process.indicatorBootConfigurationUpdateCount\": 0, \"src.process.indicatorInfostealerCount\": 0, \"process.unique.key\": \"07AED4D60C10799B\", \"cmdScript.originalSize\": 140, \"agent.version\": \"23.4.4.223\", \"src.process.parent.uid\": \"05AED4D60C10799B\", \"src.process.parent.image.sha256\": \"935c1861df1f4018d698e8b65abfa02d7e9037d8f68ca3c2065b6ca165d44ad2\", \"src.process.sessionId\": 0, \"src.process.netConnCount\": 0, \"mgmt.osRevision\": \"14393\", \"group.id\": \"7FABCCD60C10799B\", \"src.process.isRedirectCmdProcessor\": false, \"src.process.verifiedStatus\": \"verified\", \"src.process.parent.publisher\": \"MICROSOFT WINDOWS\", \"src.process.parent.startTime\": 1722588220333, \"src.process.dnsCount\": 0, \"endpoint.type\": \"server\", \"trace.id\": \"01J4945B0JAAYZXWF8ZG4A0VMZ\", \"src.process.name\": \"powershell.EXE\", \"agent.uuid\": \"f373bf5f3c5541a49aad49c5d39deac8\", \"src.process.activeContent.hash\": \"4b09001438b32e54b91cbe27685c75a316f8cdf5\", \"src.process.image.sha256\": \"ba4038fd20e474c047be8aad5bfacdb1bfc1ddbe12f803f473b7918d8d819436\", \"src.process.indicatorGeneralCount\": 161, \"src.process.crossProcessOutOfStorylineCount\": 1, \"packet.id\": \"C6BB63A4EEC044B7BFEDC8B39D2594AD\", \"src.process.registryChangeCount\": 0, \"src.process.indicatorPersistenceCount\": 0, \"src.process.parent.signedStatus\": \"signed\", \"src.process.parent.user\": \"AUTORITE NT\\\\Syst\\u00e8me\", \"tgt.file.id\": \"B76839D30C10799B\", \"account.name\": \"S - SOCRAM BANQUE\", \"event.type\": \"Command Script\", \"task.path\": \"C:\\\\zabbix\\\\scripts\\\\sb.mssql.ps1\", \"src.process.indicatorPostExploitationCount\": 8, \"src.process.parent.activeContent.signedStatus\": \"unsigned\", \"src.process.parent.pid\": 3776}"
  },
  "expected": {
    "message": "{\"src.process.parent.isStorylineRoot\": false, \"event.category\": \"command_script\", \"tgt.file.modificationTime\": -11644473600000, \"src.process.parent.image.sha1\": \"99ae9c73e9bee6f9c76d6f4093a9882df06832cf\", \"site.id\": \"1470095163515336467\", \"src.process.image.binaryIsExecutable\": true, \"src.process.parent.displayName\": \"Windows Command Processor\", \"src.process.user\": \"AUTORITE NT\\\\Syst\\u00e8me\", \"src.process.parent.subsystem\": \"SYS_WIN32\", \"src.process.indicatorRansomwareCount\": 0, \"src.process.crossProcessDupRemoteProcessHandleCount\": 7, \"src.process.activeContent.signedStatus\": \"unsigned\", \"src.process.tgtFileCreationCount\": 0, \"src.process.indicatorInjectionCount\": 0, \"src.process.moduleCount\": 1800, \"i.version\": \"preprocess-lib-1.0\", \"src.process.parent.name\": \"cmd.exe\", \"src.process.activeContentType\": \"FILE\", \"src.process.parent.activeContent.id\": \"3EFA3EFA3EFA3EFA\", \"src.process.image.md5\": \"097ce5761c89434367598b34fe32893b\", \"src.process.storyline.id\": \"7FABCCD60C10799B\", \"src.process.indicatorReconnaissanceCount\": 69, \"src.process.childProcCount\": 6, \"mgmt.url\": \"euce1-sns-mssp.sentinelone.net\", \"src.process.crossProcessOpenProcessCount\": 0, \"cmdScript.isComplete\": true, \"src.process.subsystem\": \"SYS_WIN32\", \"meta.event.name\": \"SCRIPTS\", \"src.process.parent.integrityLevel\": \"SYSTEM\", \"src.process.indicatorExploitationCount\": 0, \"src.process.parent.storyline.id\": \"7FABCCD60C10799B\", \"tgt.file.creationTime\": -11644473600000, \"src.process.integrityLevel\": \"SYSTEM\", \"i.scheme\": \"edr\", \"site.name\": \"Default site\", \"src.process.netConnInCount\": 0, \"event.time\": 1722588221803, \"timestamp\": \"2024-08-02T08:43:41.803Z\", \"account.id\": \"1470095162995242762\", \"dataSource.name\": \"SentinelOne\", \"endpoint.name\": \"ntrsql15\", \"src.process.image.sha1\": \"044a0cf1f6bc478a7172bf207eef1e201a18ba02\", \"tgt.file.size\": 50105, \"cmdScript.applicationName\": \"PowerShell_C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe_10.0.14393.0\", \"src.process.isStorylineRoot\": false, \"src.process.parent.image.path\": \"C:\\\\Windows\\\\System32\\\\cmd.exe\", \"tgt.file.sha1\": \"4b09001438b32e54b91cbe27685c75a316f8cdf5\", \"dataSource.vendor\": \"SentinelOne\", \"src.process.pid\": 3744, \"src.process.parent.activeContent.hash\": \"1b11fdf894b9a205b690add505ff5f2193c1fe48\", \"tgt.file.isSigned\": \"signed\", \"src.process.cmdline\": \"powershell  -executionpolicy bypass -file \\\"c:\\\\zabbix\\\\scripts\\\\sb.mssql.ps1\\\" poller RUIWS01 \", \"src.process.publisher\": \"MICROSOFT WINDOWS\", \"dataSource.category\": \"security\", \"src.process.crossProcessThreadCreateCount\": 0, \"src.process.parent.isNative64Bit\": false, \"src.process.parent.activeContentType\": \"CLI\", \"src.process.parent.isRedirectCmdProcessor\": false, \"src.process.parent.activeContent.path\": \"\\\\\\\\Unknown device\\\\Unknown file\", \"src.process.crossProcessCount\": 7, \"src.process.signedStatus\": \"signed\", \"tgt.file.isExecutable\": false, \"event.id\": \"01J4945B0JAAYZXWF8ZG4A0VMZ_638\", \"src.process.parent.cmdline\": \"cmd /C \\\"powershell -executionpolicy bypass -file \\\"c:\\\\zabbix\\\\scripts\\\\sb.mssql.ps1\\\" poller RUIWS01  \\\"\", \"cmdScript.content\": \"{ updateInfo_Serveurs -instance_name $instance -datas_res $res_infos }\", \"src.process.image.path\": \"C:\\\\Windows\\\\System32\\\\WINDOWSPOWERSHELL\\\\V1.0\\\\powershell.EXE\", \"src.process.tgtFileModificationCount\": 21, \"src.process.indicatorEvasionCount\": 101, \"src.process.netConnOutCount\": 0, \"cmdScript.sha256\": \"b285d770802aac13330fd7d2a0ade3c9a7adf575d160a81dfc30614c7a89e775\", \"tgt.file.path\": \"C:\\\\zabbix\\\\scripts\\\\sb.mssql.ps1\", \"tgt.file.extension\": \"ps1\", \"src.process.crossProcessDupThreadHandleCount\": 0, \"endpoint.os\": \"windows\", \"src.process.tgtFileDeletionCount\": 0, \"src.process.startTime\": 1722588220577, \"mgmt.id\": \"16205\", \"os.name\": \"Windows Server 2016 Standard\", \"tgt.file.type\": \"UNKNOWN\", \"src.process.activeContent.id\": \"B76839D30C10799B\", \"src.process.displayName\": \"Windows PowerShell\", \"src.process.activeContent.path\": \"C:\\\\zabbix\\\\scripts\\\\sb.mssql.ps1\", \"src.process.isNative64Bit\": false, \"src.process.parent.sessionId\": 0, \"src.process.uid\": \"07AED4D60C10799B\", \"src.process.parent.image.md5\": \"f4f684066175b77e0c3a000549d2922c\", \"src.process.indicatorBootConfigurationUpdateCount\": 0, \"src.process.indicatorInfostealerCount\": 0, \"process.unique.key\": \"07AED4D60C10799B\", \"cmdScript.originalSize\": 140, \"agent.version\": \"23.4.4.223\", \"src.process.parent.uid\": \"05AED4D60C10799B\", \"src.process.parent.image.sha256\": \"935c1861df1f4018d698e8b65abfa02d7e9037d8f68ca3c2065b6ca165d44ad2\", \"src.process.sessionId\": 0, \"src.process.netConnCount\": 0, \"mgmt.osRevision\": \"14393\", \"group.id\": \"7FABCCD60C10799B\", \"src.process.isRedirectCmdProcessor\": false, \"src.process.verifiedStatus\": \"verified\", \"src.process.parent.publisher\": \"MICROSOFT WINDOWS\", \"src.process.parent.startTime\": 1722588220333, \"src.process.dnsCount\": 0, \"endpoint.type\": \"server\", \"trace.id\": \"01J4945B0JAAYZXWF8ZG4A0VMZ\", \"src.process.name\": \"powershell.EXE\", \"agent.uuid\": \"f373bf5f3c5541a49aad49c5d39deac8\", \"src.process.activeContent.hash\": \"4b09001438b32e54b91cbe27685c75a316f8cdf5\", \"src.process.image.sha256\": \"ba4038fd20e474c047be8aad5bfacdb1bfc1ddbe12f803f473b7918d8d819436\", \"src.process.indicatorGeneralCount\": 161, \"src.process.crossProcessOutOfStorylineCount\": 1, \"packet.id\": \"C6BB63A4EEC044B7BFEDC8B39D2594AD\", \"src.process.registryChangeCount\": 0, \"src.process.indicatorPersistenceCount\": 0, \"src.process.parent.signedStatus\": \"signed\", \"src.process.parent.user\": \"AUTORITE NT\\\\Syst\\u00e8me\", \"tgt.file.id\": \"B76839D30C10799B\", \"account.name\": \"S - SOCRAM BANQUE\", \"event.type\": \"Command Script\", \"task.path\": \"C:\\\\zabbix\\\\scripts\\\\sb.mssql.ps1\", \"src.process.indicatorPostExploitationCount\": 8, \"src.process.parent.activeContent.signedStatus\": \"unsigned\", \"src.process.parent.pid\": 3776}",
    "event": {
      "action": "Command Script",
      "category": [
        "process"
      ],
      "dataset": "cloud-funnel-2.0",
      "type": [
        "info"
      ]
    },
    "@timestamp": "2024-08-02T08:43:41.803000Z",
    "action": {
      "properties": {
        "Path": "C:\\zabbix\\scripts\\sb.mssql.ps1",
        "ScriptBlockText": "{ updateInfo_Serveurs -instance_name $instance -datas_res $res_infos }"
      }
    },
    "agent": {
      "version": "23.4.4.223"
    },
    "deepvisibility": {
      "agent": {
        "managment_url": "euce1-sns-mssp.sentinelone.net",
        "trace_id": "01J4945B0JAAYZXWF8ZG4A0VMZ",
        "uuid": "f373bf5f3c5541a49aad49c5d39deac8"
      },
      "event": {
        "category": "command_script",
        "type": "Command Script"
      },
      "host": {
        "os": {
          "revision": "14393"
        }
      },
      "process": {
        "activecontent": {
          "hash": {
            "sha1": "4b09001438b32e54b91cbe27685c75a316f8cdf5"
          },
          "path": "C:\\zabbix\\scripts\\sb.mssql.ps1"
        },
        "parent": {
          "activecontent": {
            "path": "\\\\Unknown device\\Unknown file"
          },
          "storyline_id": "7FABCCD60C10799B"
        },
        "storyline_id": "7FABCCD60C10799B"
      },
      "script": {
        "app_name": "PowerShell_C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe_10.0.14393.0",
        "content": "{ updateInfo_Serveurs -instance_name $instance -datas_res $res_infos }"
      }
    },
    "file": {
      "code_signature": {
        "exists": false
      },
      "created": "1966-04-24T06:14:24Z",
      "directory": "C:\\zabbix\\scripts",
      "hash": {
        "sha1": "4b09001438b32e54b91cbe27685c75a316f8cdf5",
        "sha256": "b285d770802aac13330fd7d2a0ade3c9a7adf575d160a81dfc30614c7a89e775"
      },
      "mtime": "1966-04-24T06:14:24Z",
      "name": "sb.mssql.ps1",
      "path": "C:\\zabbix\\scripts\\sb.mssql.ps1",
      "size": 140
    },
    "host": {
      "name": "ntrsql15",
      "os": {
        "family": "windows",
        "name": "Windows Server 2016 Standard",
        "type": "windows"
      },
      "type": "server"
    },
    "observer": {
      "vendor": "SentinelOne"
    },
    "process": {
      "code_signature": {
        "exists": true,
        "subject_name": "MICROSOFT WINDOWS"
      },
      "command_line": "powershell  -executionpolicy bypass -file \"c:\\zabbix\\scripts\\sb.mssql.ps1\" poller RUIWS01 ",
      "executable": "C:\\Windows\\System32\\WINDOWSPOWERSHELL\\V1.0\\powershell.EXE",
      "hash": {
        "md5": "097ce5761c89434367598b34fe32893b",
        "sha1": "044a0cf1f6bc478a7172bf207eef1e201a18ba02",
        "sha256": "ba4038fd20e474c047be8aad5bfacdb1bfc1ddbe12f803f473b7918d8d819436"
      },
      "name": "powershell.EXE",
      "parent": {
        "code_signature": {
          "exists": true,
          "subject_name": "MICROSOFT WINDOWS"
        },
        "command_line": "cmd /C \"powershell -executionpolicy bypass -file \"c:\\zabbix\\scripts\\sb.mssql.ps1\" poller RUIWS01  \"",
        "executable": "C:\\Windows\\System32\\cmd.exe",
        "hash": {
          "md5": "f4f684066175b77e0c3a000549d2922c",
          "sha1": "99ae9c73e9bee6f9c76d6f4093a9882df06832cf",
          "sha256": "935c1861df1f4018d698e8b65abfa02d7e9037d8f68ca3c2065b6ca165d44ad2"
        },
        "name": "cmd.exe",
        "pid": 3776,
        "start": "2024-08-02T08:43:40.333000Z",
        "title": "Windows Command Processor",
        "user": {
          "name": "AUTORITE NT\\Syst\u00e8me"
        },
        "working_directory": "C:\\Windows\\System32"
      },
      "pid": 3744,
      "start": "2024-08-02T08:43:40.577000Z",
      "title": "Windows PowerShell",
      "user": {
        "name": "AUTORITE NT\\Syst\u00e8me"
      },
      "working_directory": "C:\\Windows\\System32\\WINDOWSPOWERSHELL\\V1.0"
    },
    "related": {
      "hash": [
        "044a0cf1f6bc478a7172bf207eef1e201a18ba02",
        "097ce5761c89434367598b34fe32893b",
        "4b09001438b32e54b91cbe27685c75a316f8cdf5",
        "935c1861df1f4018d698e8b65abfa02d7e9037d8f68ca3c2065b6ca165d44ad2",
        "99ae9c73e9bee6f9c76d6f4093a9882df06832cf",
        "b285d770802aac13330fd7d2a0ade3c9a7adf575d160a81dfc30614c7a89e775",
        "ba4038fd20e474c047be8aad5bfacdb1bfc1ddbe12f803f473b7918d8d819436",
        "f4f684066175b77e0c3a000549d2922c"
      ],
      "user": [
        "Syst\u00e8me"
      ]
    },
    "user": {
      "domain": "AUTORITE NT",
      "name": "Syst\u00e8me"
    }
  }
}